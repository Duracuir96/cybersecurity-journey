import boto3
import os
import sys
from dotenv import load_dotenv

# Load environment variables from .env file
load_dotenv()

# Get AWS environment variables (standard AWS naming)
AWS_ACCESS_KEY_ID = os.getenv("AWS_ACCESS_KEY_ID")
AWS_SECRET_ACCESS_KEY = os.getenv("AWS_SECRET_ACCESS_KEY")
AWS_REGION = os.getenv("AWS_REGION", "us-east-1")  # Default value

# Validate critical environment variables
if not AWS_ACCESS_KEY_ID or not AWS_SECRET_ACCESS_KEY:
    print("ERROR: Missing AWS environment variables.")
    print("Make sure your .env file contains:")
    print("AWS_ACCESS_KEY_ID=your_key_here")
    print("AWS_SECRET_ACCESS_KEY=your_secret_here")
    sys.exit(1)

try:
    # Create IAM client
    client = boto3.client(
        "iam",
        aws_access_key_id=AWS_ACCESS_KEY_ID,
        aws_secret_access_key=AWS_SECRET_ACCESS_KEY,
        region_name=AWS_REGION
    )
    
    # Attach administrator policy
    response = client.attach_user_policy(
        UserName='tester96',
        PolicyArn='arn:aws:iam::aws:policy/AdministratorAccess'
    )
    
    print("SUCCESS: Administrator policy attached to user 'tester96'")
    print(f"AWS Response: {response['ResponseMetadata']['HTTPStatusCode']}")
    
except client.exceptions.NoSuchEntityException as e:
    print(f"ERROR: User 'tester96' not found. Details: {e}")
    
except client.exceptions.LimitExceededException as e:
    print(f"ERROR: Policy limit exceeded. Details: {e}")
    
except client.exceptions.InvalidInputException as e:
    print(f"ERROR: Invalid input data. Details: {e}")
    
except client.exceptions.ServiceFailureException as e:
    print(f"ERROR: AWS service failure. Details: {e}")
    
except Exception as e:
    print(f"UNEXPECTED ERROR: {type(e).__name__}: {e}")